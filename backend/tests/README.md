# –¢–µ—Å—Ç—ã EncryptKeep Backend

–≠—Ç–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ —Ç–µ—Å—Ç—ã –¥–ª—è –±–µ–∫–µ–Ω–¥–∞ EncryptKeep, –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ —Ç–∏–ø–∞–º –∏ –º–æ–¥—É–ª—è–º.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
tests/
‚îú‚îÄ‚îÄ unit/           # –ú–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã (unit tests)
‚îÇ   ‚îú‚îÄ‚îÄ keymanager/ # –¢–µ—Å—Ç—ã –º–æ–¥—É–ª—è keymanager
‚îÇ   ‚îú‚îÄ‚îÄ crypto/     # –¢–µ—Å—Ç—ã –º–æ–¥—É–ª—è crypto
‚îÇ   ‚îú‚îÄ‚îÄ codec/      # –¢–µ—Å—Ç—ã –º–æ–¥—É–ª—è codec
‚îÇ   ‚îú‚îÄ‚îÄ vault/      # –¢–µ—Å—Ç—ã –º–æ–¥—É–ª—è vault
‚îÇ   ‚îî‚îÄ‚îÄ blockchain/ # –¢–µ—Å—Ç—ã –º–æ–¥—É–ª—è blockchain
‚îú‚îÄ‚îÄ integration/    # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ keymanager/ # –¢–µ—Å—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ keymanager
‚îÇ   ‚îú‚îÄ‚îÄ vault/      # –¢–µ—Å—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ vault
‚îÇ   ‚îî‚îÄ‚îÄ blockchain/ # –¢–µ—Å—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ blockchain
‚îú‚îÄ‚îÄ e2e/           # End-to-end —Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ auth/      # –¢–µ—Å—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ sync/      # –¢–µ—Å—Ç—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ gui/       # –¢–µ—Å—Ç—ã GUI
‚îú‚îÄ‚îÄ fixtures/      # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îÇ   ‚îú‚îÄ‚îÄ keys/      # –¢–µ—Å—Ç–æ–≤—ã–µ –∫–ª—é—á–∏
‚îÇ   ‚îú‚îÄ‚îÄ vaults/    # –¢–µ—Å—Ç–æ–≤—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
‚îÇ   ‚îî‚îÄ‚îÄ blockchain/ # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –±–ª–æ–∫—á–µ–π–Ω–∞
‚îî‚îÄ‚îÄ mocks/         # –ú–æ–∫–∏ –∏ –∑–∞–≥–ª—É—à–∫–∏
    ‚îú‚îÄ‚îÄ blockchain/ # –ú–æ–∫–∏ –¥–ª—è –±–ª–æ–∫—á–µ–π–Ω–∞
    ‚îú‚îÄ‚îÄ crypto/     # –ú–æ–∫–∏ –¥–ª—è –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏
    ‚îî‚îÄ‚îÄ storage/    # –ú–æ–∫–∏ –¥–ª—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
```

## üß™ –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤

### Unit Tests (–ú–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã)

- –¢–µ—Å—Ç–∏—Ä—É—é—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –º–µ—Ç–æ–¥—ã
- –ë—ã—Å—Ç—Ä—ã–µ –∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ
- –ù–µ —Ç—Ä–µ–±—É—é—Ç –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –≤ `unit/`

### Integration Tests (–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã)

- –¢–µ—Å—Ç–∏—Ä—É—é—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏
- –ú–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –ü—Ä–æ–≤–µ—Ä—è—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –≤ `integration/`

### E2E Tests (End-to-End —Ç–µ—Å—Ç—ã)

- –¢–µ—Å—Ç–∏—Ä—É—é—Ç –ø–æ–ª–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ —Å–µ—Ä–≤–∏—Å—ã
- –ü—Ä–æ–≤–µ—Ä—è—é—Ç —Ä–∞–±–æ—Ç—É –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã
- –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –≤ `e2e/`

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –í—Å–µ —Ç–µ—Å—Ç—ã

```bash
cd backend
go test ./tests/...
```

### –ú–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã

```bash
go test ./tests/unit/...
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

```bash
go test ./tests/integration/...
```

### E2E —Ç–µ—Å—Ç—ã

```bash
go test ./tests/e2e/...
```

### –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–æ–¥—É–ª—å

```bash
go test ./tests/unit/keymanager/
go test ./tests/integration/blockchain/
```

### –° –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º

```bash
go test -v ./tests/...
```

### –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞

```bash
go test -cover ./tests/...
go test -coverprofile=coverage.out ./tests/...
go tool cover -html=coverage.out
```

### –° race detection

```bash
go test -race ./tests/...
```

## üìä –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞

–î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–∞ –æ –ø–æ–∫—Ä—ã—Ç–∏–∏:

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–∫—Ä—ã—Ç–∏—è
go test -coverprofile=coverage.out ./tests/...

# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
go tool cover -func=coverage.out

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –æ—Ç—á–µ—Ç–∞
go tool cover -html=coverage.out -o coverage.html
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –î–ª—è —Ç–µ—Å—Ç–æ–≤ –±–ª–æ–∫—á–µ–π–Ω–∞
export TEST_RPC_ENDPOINT="http://localhost:8545"
export TEST_CONTRACT_ADDRESS="0x..."
export TEST_PRIVATE_KEY="0x..."

# –î–ª—è —Ç–µ—Å—Ç–æ–≤ —Å —Ñ–∞–π–ª–∞–º–∏
export TEST_DATA_DIR="/tmp/encryptkeep_test"

# –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
export TEST_LOG_LEVEL="debug"
```

### –¢–µ—Å—Ç–æ–≤—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

- `fixtures/config/` - —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- `fixtures/keys/` - —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–ª—é—á–∏ (–ù–ï –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞!)
- `fixtures/vaults/` - —Ç–µ—Å—Ç–æ–≤—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

## üìù –ù–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞

```go
package keymanager_test

import (
    "testing"
    "encryptkeep-backend/internal/keymanager"
    "encryptkeep-backend/tests/fixtures"
)

func TestKeyManager_Create(t *testing.T) {
    // Arrange
    config := fixtures.GetTestKeyManagerConfig()

    // Act
    km := keymanager.NewKeyManager(config)

    // Assert
    if km == nil {
        t.Error("Expected KeyManager, got nil")
    }
}
```

### –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

- `TestModuleName_MethodName` - –¥–ª—è –º–µ—Ç–æ–¥–æ–≤
- `TestModuleName_Scenario_ExpectedResult` - –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- `BenchmarkModuleName_MethodName` - –¥–ª—è –±–µ–Ω—á–º–∞—Ä–∫–æ–≤

### –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `fixtures/` –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –≤ —Ç–µ—Å—Ç–∞—Ö
- –û—á–∏—â–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–æ–≤

## üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–æ–∫–æ–≤

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ mockgen
go install github.com/golang/mock/mockgen@latest

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–æ–∫–æ–≤
mockgen -source=internal/blockchain/client.go -destination=tests/mocks/blockchain/mock_client.go
```

### –õ–∏–Ω—Ç–∏–Ω–≥ —Ç–µ—Å—Ç–æ–≤

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ golangci-lint
go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest

# –ó–∞–ø—É—Å–∫ –ª–∏–Ω—Ç–µ—Ä–∞
golangci-lint run ./tests/...
```

## üìã –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ç–µ—Å—Ç–æ–≤

- [ ] –¢–µ—Å—Ç –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- [ ] –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∫ —É—Å–ø–µ—à–Ω—ã–µ, —Ç–∞–∫ –∏ –æ—à–∏–±–æ—á–Ω—ã–µ —Å–ª—É—á–∞–∏
- [ ] –¢–µ—Å—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω –∏ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥—Ä—É–≥–∏—Ö —Ç–µ—Å—Ç–æ–≤
- [ ] –¢–µ—Å—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ `fixtures/`
- [ ] –¢–µ—Å—Ç –æ—á–∏—â–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- [ ] –¢–µ—Å—Ç –∏–º–µ–µ—Ç –ø–æ–Ω—è—Ç–Ω–æ–µ –∏–º—è –∏ –æ–ø–∏—Å–∞–Ω–∏–µ
- [ ] –¢–µ—Å—Ç —Å–ª–µ–¥—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—É Arrange-Act-Assert

## üîç –û—Ç–ª–∞–¥–∫–∞ —Ç–µ—Å—Ç–æ–≤

### –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞

```bash
go test -run TestKeyManager_Create ./tests/unit/keymanager/
```

### –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥

```bash
go test -v -run TestKeyManager_Create ./tests/unit/keymanager/
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–µ

```bash
go test -failfast ./tests/...
```

### –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

```bash
go test -parallel 4 ./tests/...
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Go Testing Documentation](https://golang.org/pkg/testing/)
- [Testify Library](https://github.com/stretchr/testify) - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- [GoMock](https://github.com/golang/mock) - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –º–æ–∫–æ–≤
- [Testcontainers](https://golang.testcontainers.org/) - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
